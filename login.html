<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Koh+Santepheap:wght@100;300;400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="login">
      <!-- left side -->
      <div id="login1">
        <div id="icon">
          <img src="./images/image_2.png" alt="" id="image" />
          <img src="./images/image_1.png" alt="" />
        </div>
        <p id="para2">Ease Your Booking <span id="span">With The </span></p>
        <h3 id="heading5">Board Room</h3>
        <h1 id="heading6">RESERVATION</h1>
        <h1 id="heading7">PORTAL !</h1>
        <p id="para3">Our Gateway For Seamless Bookings</p>
      </div>

      <!-- right side -->
      <div id="login2">
        <img src="./images/verify_box.png" alt="" />
        <h2 id="heading8">Welcome To Boardroom And Transportation</h2>

        <div class="input-wrapper">
          <input type="text" placeholder="Enter your email" id="email-input">
          <img src="./images/frame_1.png" alt="Icon" class="input-icon">
        </div>

        <div class="input-wrapper">
          <input type="password" placeholder="Enter your password" id="pass-input">
          <img src="./images/frame_2.png" alt="Icon" class="input-icon2">
        </div>

        <button id="login-btn">Login</button>
        <p id="error-msg" style="color:red; display:none; margin-top:10px;">
          Invalid email or password
        </p>
      </div>
    </div>

    <script>
  const loginBtn = document.getElementById("login-btn");

  loginBtn?.addEventListener("click", async () => {
    const email = document.getElementById("email-input").value.trim();
    const password = document.getElementById("pass-input").value.trim();
    const errorMsg = document.getElementById("error-msg");

    try {
      const res = await fetch("http://localhost:5000/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });

      const data = await res.json();

      if (res.ok) {
        // Save session
        localStorage.setItem("isLoggedIn", "true");
        localStorage.setItem("token", data.token);              // ✅ important
        localStorage.setItem("userFullName", data.full_name);
        localStorage.setItem("userRoleId", String(data.role_id)); // ✅ use role_id

        // Role-based redirect (1 = admin, 2 = user)
        if (Number(data.role_id) === 1) {
          window.location.href = "admin.html";
        } else {
          window.location.href = "home.html";
        }
      } else {
        errorMsg.innerText = data.error || "Login failed";
        errorMsg.style.display = "block";
      }
    } catch (err) {
      errorMsg.innerText = "Server error: " + err.message;
      errorMsg.style.display = "block";
    }
  });
</script>


</body>
</html>